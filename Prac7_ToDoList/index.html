<h2>To-Do List</h2>

<input type="text" id="taskInput" placeholder="Enter a task">
<button onclick="addTask()">Add</button>
<button onclick="sortAZ()">Sort A-Z</button>
<button onclick="sortZA()">Sort Z-A</button>

<p>Total Tasks: <span id="taskCount">0</span></p>

<ul id="todoList"></ul>

<script>
// Load tasks on page load
window.onload = loadTasks;

function addTask(e) {
    if (e && e.key !== "Enter") return;

    const input = document.getElementById('taskInput');
    const taskText = input.value.trim();
    if (!taskText) return;

    // Prevent duplicate task
    const tasks = document.querySelectorAll("#todoList li span");
    for (let t of tasks) {
        if (t.textContent.toLowerCase() === taskText.toLowerCase()) {
            alert("Task already exists!");
            return;
        }
    }

    createTaskElement(taskText);
    input.value = '';
    updateCount();
    saveTasks();
}

// Create Task DOM Element
function createTaskElement(taskText) {
    const li = document.createElement('li');

    // Display span
    const span = document.createElement('span');
    span.textContent = taskText;

    // Hover highlight
    li.onmouseover = () => li.style.background = "#f0f0f0";
    li.onmouseout = () => li.style.background = "";

    // Complete Button
    const completeBtn = document.createElement('button');
    completeBtn.textContent = "Complete";
    completeBtn.onclick = () => {
        span.classList.toggle("done");
        span.style.textDecoration = span.classList.contains("done") ? "line-through" : "none";
        saveTasks();
    };

    // Edit Button (Inline Edit)
    const editBtn = document.createElement('button');
    editBtn.textContent = "Edit";
    editBtn.onclick = function () {
        const inputBox = document.createElement("input");
        inputBox.type = "text";
        inputBox.value = span.textContent;

        const saveBtn = document.createElement("button");
        saveBtn.textContent = "Save";

        // Save changes
        saveBtn.onclick = function () {
            const newTask = inputBox.value.trim();
            if (!newTask) return alert("Task cannot be empty!");

            // Duplicate check
            const tasks = document.querySelectorAll("#todoList li span");
            for (let t of tasks) {
                if (t !== span && t.textContent.toLowerCase() === newTask.toLowerCase()) {
                    alert("Task already exists!");
                    return;
                }
            }

            span.textContent = newTask;
            li.replaceChild(span, inputBox);
            li.replaceChild(editBtn, saveBtn);
            updateCount();
            saveTasks();
        };

        li.replaceChild(inputBox, span);
        li.replaceChild(saveBtn, editBtn);
    };

    // Delete Button (with confirm)
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = "Delete";
    deleteBtn.onclick = function () {
        if (confirm("Are you sure you want to delete this task?")) {
            li.remove();
            updateCount();
            saveTasks();
        }
    };

    li.appendChild(span);
    li.appendChild(completeBtn);
    li.appendChild(editBtn);
    li.appendChild(deleteBtn);

    document.getElementById('todoList').appendChild(li);
}

// Count tasks
function updateCount() {
    document.getElementById('taskCount').textContent =
        document.querySelectorAll("#todoList li").length;
}

// Enter key to add task
document.getElementById("taskInput").addEventListener("keypress", addTask);

// LocalStorage Save
function saveTasks() {
    const tasks = [];
    document.querySelectorAll("#todoList li span").forEach(span => {
        tasks.push({
            text: span.textContent,
            done: span.classList.contains("done")
        });
    });
    localStorage.setItem("tasks", JSON.stringify(tasks));
}

// Load tasks
function loadTasks() {
    const saved = JSON.parse(localStorage.getItem("tasks") || "[]");
    saved.forEach(t => {
        createTaskElement(t.text);
        const spans = document.querySelectorAll("#todoList li span");
        const span = spans[spans.length-1];
        if (t.done) {
            span.classList.add("done");
            span.style.textDecoration = "line-through";
        }
    });
    updateCount();
}

// Sorting Functions
function sortAZ() {
    sortTasks(true);
}

function sortZA() {
    sortTasks(false);
}

function sortTasks(asc) {
    const list = document.getElementById("todoList");
    const items = Array.from(list.children);

    items.sort((a, b) => {
        const t1 = a.querySelector("span").textContent.toLowerCase();
        const t2 = b.querySelector("span").textContent.toLowerCase();
        return asc ? t1.localeCompare(t2) : t2.localeCompare(t1);
    });

    list.innerHTML = "";
    items.forEach(i => list.appendChild(i));
    saveTasks();
}
</script>
